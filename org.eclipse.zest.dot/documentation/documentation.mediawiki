= User Guide: Graphviz DOT as a DSL for Zest (dot4zest) =

This Eclipse feature provides support for the [http://www.graphviz.org/ Graphviz] [http://www.graphviz.org/doc/info/lang.html DOT language] as a domain-specific language (DSL) for [http://www.eclipse.org/gef/zest/ Zest: The Eclipse Visualization Toolkit], both as an input and output format. It provides API und UI elements to transform both DOT graphs to Zest visualizations (to be used in Java SWT applications), and Zest visualizations to DOT graphs (to be rendered as image files with Graphviz).

== Installation ==

In Eclipse 3.5, install the ''dot4zest''  feature under the ''Zest'' category from the update site at: ''<nowiki>http://quui.de/updates</nowiki>''

== GUI ==

In the UI, this feature adds two wizards ('New Zest Graph' and 'New Zest Project') under a category labeled 'Visualization':

[[Image:DotZestWizards.png|400px]]

And a 'Zest Graph' view:

[[Image:DotZestViewSelection.png]]

=== New Zest Project ===

The project created by the wizard contains a 'templates' folder containing sample DOT files. The DOT files in the 'templates' folder are compiled to Zest graph subclasses by the builder, which can be launched as Java applications to view the Zest Graph:

[[Image:DotZestProjectWizard.png|400px]]

This  implements a basic Zest authoring environment using DOT as a DSL, as upon saving the DOT file, the same Zest application can be relaunched, showing the Zest graph created from the changed DOT file.

=== New Zest Graph ===

In the first page the container and a graph template are selected, the resulting Zest graph for the template is previewed:

[[Image:DotZestGraphWizardPage.png|400px]]

In the second page the DOT representation of the selected template can be customized. After the wizard finishes, it tries to run the generated Zest Graph to display the result (here customized in the second page):

[[Image:DotZestGraphWizardResult.png|200px]]

The generated Zest file will be in the ''org.eclipse.zest.dot'' package. To get a compiling result without setting up anything, select the ''org.eclipse.zest.dot'' package in the ''src-gen'' folder of a Zest project as the container in the wizard (or select it before starting the wizard).

=== Zest Graph View ===

The Zest Graph view listens to changes made to *.dot files in the workspace. The view draws the DOT graphs using Zest and allows for image export of the current Zest graph. When a *.dot file is added to the workspace or altered in an editor, the Zest graph view will be updated with the graph created from the *.dot file, e.g.  for a file with the .dot extension, containing the following DOT graph definition: 

 digraph s{ 
  n1[label="Node 1"]; n2[label="Node 2"]; 
  n1 -> n2[style=dotted label="A dotted edge"]
 }
  
The view will display:

[[Image:DotZestM8Screenshot2.png|200px]]

The view contains buttons to load a specific *.dot file, to export the current Zest graph as an image file by calling dot, to layout the current graph, and to re-select the directory containing the dot executable (from left to right). When the image export button is selected, a PDF for the current graph is saved in the directory containing the input *.dot file:

[[Image:DotZestM2Rendered.png]]

This completes the Zest-based DOT authoring environment: if the *.dot file is inside the /templates folder of a Zest project, the file will both be visualized in the Zest Graph view (e.g. during editing) and compiled to a Zest graph subclass (e.g. to be used in a different application), and can be exported as a PDF with Graphviz.

== API ==

Via the API DOT can be imported to Zest graph subclasses (*.java files) or Zest graph instances, and Zest graph instances can be exported to DOT or image files.

=== DOT Import ===

A short DOT import API sample:

 /* The DOT input, can be given as a String, File or IFile: */
 DotImport importer = new DotImport("digraph Simple { 1;2; 1->2 }");
 /* Compile the DOT input to a Zest graph subclass: */
 File file = importer.newGraphSubclass();
 /* Or create a Zest graph instance in a parent, with a style: */
 Graph graph = importer.newGraphInstance(shell, SWT.NONE);

=== DOT Export ===

A short DOT export API sample:

 /* For some Zest graph, we create the exporter: */
 DotExport exporter = new DotExport(graph);
 /* Export the Zest graph to DOT: */
 String dot = exporter.toDotString();
 /* Or to an image file, via a given Graph installation: */
 File image = exporter.toImage("/opt/local/bin", "pdf");

The complete sample usage is [http://cvs.berlios.de/cgi-bin/viewvc.cgi/dot4zest/org.eclipse.zest.dot.import/src-test/org/eclipse/zest/dot/SampleUsage.java?revision=1.3&view=markup available in the repository], as well as working [http://cvs.berlios.de/cgi-bin/viewvc.cgi/dot4zest/org.eclipse.zest.dot.import/resources/tests/ DOT input samples].

== Animation ==

The DOT import implementation contains experimental animation support, representing animation steps as subgraphs in the DOT input (which if rendered with Graphviz results in a static description of the animation). 

For instance, for the input below a Zest animation is created in which the single steps can be executed by clicking the button below the graph:

 digraph SampleAnimation {
  /* We can specify a Zest layout for the animation here: */
  layout=tree // = TreeLayoutAlgorithm
  /* Global attributes can be defined for edges and nodes: */
  node[label="Node"]
  edge[label="Edge" style=dotted]
  1;2;3;4;5
  /* The single animation steps are marked by numbers: */
  subgraph cluster_0{ 1 -> 2 [label="Dashed" style=dashed]}
  subgraph cluster_1{ 1 -> 3 }
  /* The final animation step needs to be marked with "end": */
  subgraph cluster_2_end{ 3 -> 4; 3 -> 5}
 }

After the first step:

[[Image:DotZestM5Screenshot1.png|200px]]

And the final state of the graph:

[[Image:DotZestM5Screenshot2.png|200px]]

The same input file, exported with Graphviz, shows the animation steps as subgraphs:

[[Image:DotZestAnimatedExport.png|200px]]

A possible use case for defining such animations with DOT is to easily create animated course material, e.g. to explain data structures. The same file defining the animation can be used to export a PDF illustrating the steps in a static way.